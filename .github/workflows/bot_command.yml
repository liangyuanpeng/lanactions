name: bot_command
on:
  push:
  workflow_dispatch:
    inputs:
      ref:
        description: 'source ref '
        required: false
        default: "main"
      repo:
        description: 'repo'
        required: false
        default: ""

jobs:

  repush:
    name: repush
    permissions: write-all
    runs-on: ubuntu-latest
    steps:
      - name: checkoutactions
        uses: actions/checkout@v4
        with:
          repository: ${{ inputs.repo }}
          fetch-depth: 0
          ref: ${{ inputs.ref }}

      - name: run 
        run: |
          #TODO 需要单独一个 gh token
          git config --global user.email "gcslyp@gmail.com"
          git config --global user.name "Lan Liang"
          COMMIT_MESSAGE=`git log --pretty=format:"%s" -1`
          git commit -s --amend -m $COMMIT_MESSAGE
          git remote add upstream https://liangyuanpeng:$GH_TOKEN@github.com/${{ inputs.repo }}
          git branch -a
          git push upstream -f ${{ inputs.ref }}:${{ inputs.ref }}
